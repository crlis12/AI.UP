#!/usr/bin/env node

const { runReportAgent } = require('./services/reportAgent');

async function testKDSTReportDirect() {
  console.log('ğŸ§ª KDST RAG â†’ ReportAgent ì§ì ‘ ì—°ê²° í…ŒìŠ¤íŠ¸');
  console.log('=' * 60);
  
  try {
    // 1. KDST RAG ê²°ê³¼ë¥¼ ì§ì ‘ ìƒì„± (í•˜ë“œì½”ë”©)
    console.log('1ï¸âƒ£ KDST RAG ê²°ê³¼ ì¤€ë¹„...');
    
    const kdstRagContext = {
      kdst_questions: [
        "ì—ë“œë¦° ìì„¸ì—ì„œ ë’¤ì§‘ëŠ”ë‹¤.",
        "ë“±ì„ ëŒ€ê³  ëˆ„ìš´ ìì„¸ì—ì„œ ì—ë“œë¦° ìì„¸ë¡œ ë’¤ì§‘ëŠ”ë‹¤(íŒ”ì´ ëª¸í†µì— ê¹”ë ¤ ìˆì§€ ì•Šì•„ì•¼ í•œë‹¤).",
        "ëˆ„ì›Œ ìˆì„ ë•Œ ìê¸° ë°œì„ ì¡ê³  ë…¼ë‹¤"
      ],
      rag_results: [
        {
          "ë¬¸ì œ": "ì—ë“œë¦° ìì„¸ì—ì„œ ë’¤ì§‘ëŠ”ë‹¤.",
          "ì¼ê¸°": [
            {
              "diary_id": 21,
              "text": "8ì›” 15ì¼ : ì˜¤ëŠ˜ì€ ì¥ë‚œê°ì„ í•œ ì†ì—ì„œ ë‹¤ë¥¸ ì†ìœ¼ë¡œ ì˜®ê¸°ëŠ” ê±¸ ì„±ê³µí–ˆë‹¤. ê±°ìš¸ì„ ë³´ì—¬ì£¼ì ìê¸° ì–¼êµ´ì„ ë³´ë©° í™œì§ ì›ƒëŠ”ë‹¤. ìŠ¤ìŠ¤ë¡œë¥¼ ì¸ì‹í•˜ì§„ ëª»í•˜ê² ì§€ë§Œ, ë¬´ì–¸ê°€ ì¬ë¯¸ìˆì–´ í•˜ëŠ” ê²Œ ë¶„ëª…í•˜ë‹¤.",
              "date": "8ì›” 15ì¼",
              "similarity": 0.3159
            },
            {
              "diary_id": 23,
              "text": "8ì›” 17ì¼ : ë°¤ì— ì ì‹œ ê¹¼ì§€ë§Œ ë‚´ê°€ í† ë‹¥ì—¬ ì£¼ì ê¸ˆì„¸ ë‹¤ì‹œ ì ë“¤ì—ˆë‹¤. ë‚®ì—ëŠ” ì˜†ìœ¼ë¡œ ë°êµ´ë°êµ´ êµ´ëŸ¬ ë°© í•œìª½ ëê¹Œì§€ ì´ë™í–ˆë‹¤. í˜¸ê¸°ì‹¬ì´ ì ì  ì»¤ì§€ëŠ” ê²Œ ëŠê»´ì¡Œë‹¤. ì´ë²ˆ ì£¼ëŠ” í•œì¸µ ë” í™œë°œí•˜ê³  ë°˜ì‘ì´ í’ë¶€í•´ì§„ ì¼ì£¼ì¼ì´ì—ˆë‹¤.",
              "date": "8ì›” 17ì¼",
              "similarity": 0.3006
            },
            {
              "diary_id": 19,
              "text": "8ì›” 13ì¼ : ì ê¹ í˜¼ì ì•‰ìœ¼ë ¤ëŠ” ì‹œë„ë¥¼ í–ˆë‹¤. ê¸ˆì„¸ íœ˜ì²­ê±°ë¦¬ë©° ë„˜ì–´ì§€ì§€ë§Œ ì¡°ê¸ˆì”© ê· í˜•ì„ ì¡ëŠ”ë‹¤. ì˜¤ëŠ˜ì€ ì´ìœ ì‹ì„ ë‘ì„¸ ìˆŸê°ˆ ë¨¹ì—ˆëŠ”ë°, ì²˜ìŒë³´ë‹¤ í‘œì •ì´ í•œê²° ì—¬ìœ ë¡­ë‹¤. ìˆŸê°€ë½ì„ ëºìœ¼ë ¤ëŠ” ëª¨ìŠµê¹Œì§€ ë³´ì—¬ì„œ ë†€ëë‹¤.",
              "date": "8ì›” 13ì¼",
              "similarity": 0.2969
            }
          ]
        },
        {
          "ë¬¸ì œ": "ë“±ì„ ëŒ€ê³  ëˆ„ìš´ ìì„¸ì—ì„œ ì—ë“œë¦° ìì„¸ë¡œ ë’¤ì§‘ëŠ”ë‹¤(íŒ”ì´ ëª¸í†µì— ê¹”ë ¤ ìˆì§€ ì•Šì•„ì•¼ í•œë‹¤).",
          "ì¼ê¸°": [
            {
              "diary_id": 19,
              "text": "8ì›” 13ì¼ : ì ê¹ í˜¼ì ì•‰ìœ¼ë ¤ëŠ” ì‹œë„ë¥¼ í–ˆë‹¤. ê¸ˆì„¸ íœ˜ì²­ê±°ë¦¬ë©° ë„˜ì–´ì§€ì§€ë§Œ ì¡°ê¸ˆì”© ê· í˜•ì„ ì¡ëŠ”ë‹¤. ì˜¤ëŠ˜ì€ ì´ìœ ì‹ì„ ë‘ì„¸ ìˆŸê°ˆ ë¨¹ì—ˆëŠ”ë°, ì²˜ìŒë³´ë‹¤ í‘œì •ì´ í•œê²° ì—¬ìœ ë¡­ë‹¤. ìˆŸê°€ë½ì„ ëºìœ¼ë ¤ëŠ” ëª¨ìŠµê¹Œì§€ ë³´ì—¬ì„œ ë†€ëë‹¤.",
              "date": "8ì›” 13ì¼",
              "similarity": 0.3623
            },
            {
              "diary_id": 23,
              "text": "8ì›” 17ì¼ : ë°¤ì— ì ì‹œ ê¹¼ì§€ë§Œ ë‚´ê°€ í† ë‹¥ì—¬ ì£¼ì ê¸ˆì„¸ ë‹¤ì‹œ ì ë“¤ì—ˆë‹¤. ë‚®ì—ëŠ” ì˜†ìœ¼ë¡œ ë°êµ´ë°êµ´ êµ´ëŸ¬ ë°© í•œìª½ ëê¹Œì§€ ì´ë™í–ˆë‹¤. í˜¸ê¸°ì‹¬ì´ ì ì  ì»¤ì§€ëŠ” ê²Œ ëŠê»´ì¡Œë‹¤. ì´ë²ˆ ì£¼ëŠ” í•œì¸µ ë” í™œë°œí•˜ê³  ë°˜ì‘ì´ í’ë¶€í•´ì§„ ì¼ì£¼ì¼ì´ì—ˆë‹¤.",
              "date": "8ì›” 17ì¼",
              "similarity": 0.3376
            },
            {
              "diary_id": 18,
              "text": "8ì›” 12ì¼ : ë‚®ì ì—ì„œ ê¹¬ ì•„ê¸°ê°€ í˜¼ì ì›ƒìŒì„ í„°ëœ¨ë ¸ë‹¤. ë‹¤ë¦¬ë¥¼ ë²ˆì© ë“¤ê³  ë°œëì„ ì¡ìœ¼ë ¤ëŠ” ëª¨ìŠµì´ ë„ˆë¬´ ê·€ì—½ë‹¤. ìˆ˜ìœ í•  ë•Œ ë‚´ ëˆˆì„ ë˜‘ë°”ë¡œ ë°”ë¼ë³´ëŠ”ë°, ëˆˆë¹› ì† êµê°ì´ ê¹Šì–´ì¡Œë‹¤.",
              "date": "8ì›” 12ì¼",
              "similarity": 0.3292
            }
          ]
        },
        {
          "ë¬¸ì œ": "ëˆ„ì›Œ ìˆì„ ë•Œ ìê¸° ë°œì„ ì¡ê³  ë…¼ë‹¤",
          "ì¼ê¸°": [
            {
              "diary_id": 17,
              "text": "8ì›” 11ì¼ : ì˜¤ëŠ˜ì€ ì•„ê¸°ê°€ í˜¼ì ë’¤ì§‘ì€ ë’¤ ì¥ë‚œê°ì„ ì¡ìœ¼ë ¤ê³  ì†ì„ ë»—ì—ˆë‹¤. ì•„ì§ì€ ì†ëì´ ì„œíˆ´ì§€ë§Œ, ì˜ì§€ê°€ ë³´ì—¬ì„œ ëŒ€ê²¬í•˜ë‹¤. \"ë°”ë°”ë°”\" ì˜¹ì•Œì´ë¥¼ í•˜ê¸¸ë˜ ë”°ë¼ í•´ì£¼ë‹ˆ ê¹Œë¥´ë¥´ ì›ƒì—ˆë‹¤. ì ì  ì†Œí†µì´ ë˜ëŠ” ê¸°ë¶„ì´ë‹¤.",
              "date": "8ì›” 11ì¼",
              "similarity": 0.3653
            },
            {
              "diary_id": 21,
              "text": "8ì›” 15ì¼ : ì˜¤ëŠ˜ì€ ì¥ë‚œê°ì„ í•œ ì†ì—ì„œ ë‹¤ë¥¸ ì†ìœ¼ë¡œ ì˜®ê¸°ëŠ” ê±¸ ì„±ê³µí–ˆë‹¤. ê±°ìš¸ì„ ë³´ì—¬ì£¼ì ìê¸° ì–¼êµ´ì„ ë³´ë©° í™œì§ ì›ƒëŠ”ë‹¤. ìŠ¤ìŠ¤ë¡œë¥¼ ì¸ì‹í•˜ì§„ ëª»í•˜ê² ì§€ë§Œ, ë¬´ì–¸ê°€ ì¬ë¯¸ìˆì–´ í•˜ëŠ” ê²Œ ë¶„ëª…í•˜ë‹¤.",
              "date": "8ì›” 15ì¼",
              "similarity": 0.3250
            },
            {
              "diary_id": 18,
              "text": "8ì›” 12ì¼ : ë‚®ì ì—ì„œ ê¹¬ ì•„ê¸°ê°€ í˜¼ì ì›ƒìŒì„ í„°ëœ¨ë ¸ë‹¤. ë‹¤ë¦¬ë¥¼ ë²ˆì© ë“¤ê³  ë°œëì„ ì¡ìœ¼ë ¤ëŠ” ëª¨ìŠµì´ ë„ˆë¬´ ê·€ì—½ë‹¤. ìˆ˜ìœ í•  ë•Œ ë‚´ ëˆˆì„ ë˜‘ë°”ë¡œ ë°”ë¼ë³´ëŠ”ë°, ëˆˆë¹› ì† êµê°ì´ ê¹Šì–´ì¡Œë‹¤.",
              "date": "8ì›” 12ì¼",
              "similarity": 0.3203
            }
          ]
        }
      ]
    };
    
    console.log('âœ… RAG ì»¨í…ìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ');
    console.log(`ì´ ë¬¸ì œ ìˆ˜: ${kdstRagContext.kdst_questions.length}`);
    console.log(`ì´ ê´€ë ¨ ì¼ê¸° ìˆ˜: ${kdstRagContext.rag_results.reduce((sum, r) => sum + r.ì¼ê¸°.length, 0)}`);
    console.log();
    
    // 2. ReportAgentë¡œ ë³´ê³ ì„œ ìƒì„±
    console.log('2ï¸âƒ£ ReportAgentë¡œ KDST ë³´ê³ ì„œ ìƒì„±...');
    
    const reportConfig = {
      vendor: 'gemini',
      model: 'gemini-2.5-flash',
      temperature: 0.7
    };
    
    const reportSpec = {
      reportType: 'KDST Development Assessment Report',
      audience: 'Child Development Professionals and Parents',
      tone: 'Professional and Informative',
      length: 'Comprehensive',
      language: 'Korean',
      format: 'Markdown',
      includeSummary: true,
      sections: [
        'Executive Summary',
        'KDST Question Analysis',
        'Behavioral Observations',
        'Development Assessment',
        'Recommendations'
      ]
    };
    
    const reportInput = `
KDST ë¬¸ì œë“¤ì— ëŒ€í•œ RAG ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì „ë¬¸ì ì¸ ì•„ê¸° ë°œë‹¬ í‰ê°€ ë³´ê³ ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

ê° KDST ë¬¸ì œë³„ë¡œ:
1. ë¬¸ì œì˜ ì˜ë¯¸ì™€ ë°œë‹¬ì  ì¤‘ìš”ì„±
2. ê´€ë ¨ ì¼ê¸° ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ í•œ í–‰ë™ ê´€ì°° ë¶„ì„
3. í˜„ì¬ ë°œë‹¬ ë‹¨ê³„ í‰ê°€
4. í–¥í›„ ë°œë‹¬ ë°©í–¥ ì œì•ˆ

RAG ê²€ìƒ‰ ê²°ê³¼ì˜ ì¼ê¸° ë‚´ìš©ì„ êµ¬ì²´ì ìœ¼ë¡œ ì¸ìš©í•˜ì—¬ ê·¼ê±°ë¥¼ ì œì‹œí•´ì£¼ì„¸ìš”.
`;
    
    const reportResult = await runReportAgent({
      input: reportInput,
      history: [],
      context: {},
      config: reportConfig,
      spec: reportSpec,
      kdstRagContext: kdstRagContext
    });
    
    console.log('âœ… ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ');
    console.log();
    
    // 3. ìƒì„±ëœ ë³´ê³ ì„œ ì¶œë ¥
    console.log('3ï¸âƒ£ ìƒì„±ëœ KDST ë³´ê³ ì„œ:');
    console.log('=' * 60);
    console.log(reportResult.content);
    console.log('=' * 60);
    
  } catch (error) {
    console.error('âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error.message);
    console.error('ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤:', error.stack);
  }
}

// í…ŒìŠ¤íŠ¸ ì‹¤í–‰
testKDSTReportDirect();
